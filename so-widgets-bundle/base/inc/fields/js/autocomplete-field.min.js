!function(e){const t=function(t){const n=e(this);if(n.data("initialized"))return;const i=n.find(" .existing-content-selector"),s=parseInt(jQuery("#post_ID").val()),o=function(){const e=n.find("input.siteorigin-widget-input").val();return 0===e.length?[]:e.split(",")},a=function(){const t=o();n.find("ul.items > li").each(function(n,i){const s=e(this);t.indexOf(s.data("value"))>-1?s.addClass("selected"):s.removeClass("selected")})},d=n.find("ul.items"),l=n.find(".content-no-results");const c=()=>{const t=n.find(".content-text-search"),i=t.val(),o=t.data("source"),a=t.data("postTypes"),c=t.data("ajaxParams"),r={action:"so_widgets_search_"+o,postId:s};return"posts"===o?(r.query=i,r.postTypes=a):"terms"===o&&(r.term=i),c&&"object"==typeof c&&!Array.isArray(c)&&(Object.assign(r,c),r.action="so_widgets_search_"+o),"string"==typeof icl_this_lang&&(r.language=icl_this_lang),l.addClass("hidden"),d.empty(),d.removeClass("hidden"),d.addClass("loading"),e.get(window.top.soWidgets.ajaxurl,r,t=>{if(0===t.length)return l.removeClass("hidden"),d.addClass("hidden"),void d.removeClass("loading");t.forEach(t=>{""===t.label&&(t.label="&nbsp;"),d.append(e("<li>").html(t.label+"<span>("+t.type+")</span>").data(t))}),d.removeClass("loading")})};n.find(".siteorigin-widget-autocomplete-input").on("click",()=>{l.addClass("hidden"),d.show(),i.show();let t=new e.Deferred;i.is(":visible")&&0===i.find("ul.items li").length?t=c():t.resolve(),t.done(a)});const r=function(){i.hide()};e(window).on("mousedown",function(e){0===n.find(e.target).length&&r()}),n.find(".button-close").on("click",r),n.on("click keypress",".items li",function(t){if(t.preventDefault(),"keyup"==t.type&&!window.sowbForms.isEnter(t))return;const s=n.find("input.siteorigin-widget-input"),a=e(this),d=a.data("value");if(i.data("multiple")){const e=o(),t=e.indexOf(d);t>-1?(e.splice(t,1),a.removeClass("selected")):(e.push(d),a.addClass("selected")),s.val(e.join(","))}else a.parent().find(".selected").removeClass("selected"),a.addClass("selected"),s.val(d),r();s.trigger("change")});let u=null;n.find(".content-text-search").on("keyup",function(){null!==u&&clearTimeout(u),u=setTimeout(function(){c()},500)}),n.data("initialized",!0)};window.top===window.self&&"string"==typeof pagenow&&"site-editor"!==pagenow&&e(document).on("sowsetupformfield",".siteorigin-widget-field-type-autocomplete",t),window.addEventListener("message",function(n){n.data&&"sowbBlockFormInit"===n.data.action&&e(".siteorigin-widget-field-type-autocomplete").each(function(){t.call(this)})})}(jQuery);